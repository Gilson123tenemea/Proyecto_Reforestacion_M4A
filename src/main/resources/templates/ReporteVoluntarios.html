<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Ecuador - Provincias</title>
    <!-- Incluir la biblioteca de ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
    <style>
        /* Estilos para centrar el contenido y aumentar el tamaño */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        h1 {
            font-size: 24px;
            margin: 20px 0;
        }
        #main {
            width: 90%; /* Aumentar el tamaño del mapa */
            height: 600px; /* Aumentar la altura del mapa */
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>Mapa de Ecuador - Provincias</h1>
	<div class="card">
	           <div class="card-header text-center">
	               <h3>Seleccionar Proyecto</h3>
	           </div>
	           <div class="card-body text-center">
	               <form id="proyectoForm" method="post" th:action="@{/MostrarVoluntarios}">
	                   <select class="form-select" name="idProyecto" id="proyecto" onchange="enviarProyecto()">
	                       <option selected>Selecciona un proyecto</option>
	                       <option th:each="proyecto : ${proyectos}" 
	                               th:value="${proyecto.id_proyecto}" 
	                               th:text="${proyecto.nombre}"></option>
	                   </select>
	               </form>
	           </div>
	       </div>
    <div id="main"></div>
	
	

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Incluir jQuery -->

	<script>
		function enviarProyecto() {
		          document.getElementById("proyectoForm").submit();
		      }
	</script>
    <script>
        // Inicializar el gráfico
        var myChart = echarts.init(document.getElementById('main'));

        myChart.showLoading();

        // Cargar el archivo GeoJSON de Ecuador desde la carpeta static
        $.get('/ec.json', function (ecuadorJson) {
            console.log('GeoJSON cargado correctamente');
            myChart.hideLoading();
            
            // Registrar el mapa de Ecuador con ajustes si es necesario
            echarts.registerMap('Ecuador', ecuadorJson, {
                'Galápagos': {
                    left: -90,
                    top: -0.5,
                    width: 5
                }
            });

            // Datos de provincias y sus valores (por ejemplo, población)
			// Datos de provincias y sus valores (número de voluntarios)
			        var data = [
			            { name: 'Azuay', value: 50 },
			            { name: 'Bolívar', value: 30 },
			            { name: 'Cañar', value: 45 },
			            { name: 'Carchi', value: 60 },
			            { name: 'Chimborazo', value: 40 },
			            { name: 'Cotopaxi', value: 70 },
			            { name: 'El Oro', value: 80 },
			            { name: 'Esmeraldas', value: 20 },
			            { name: 'Guayas', value: 100 },
			            { name: 'Imbabura', value: 25 },
			            { name: 'Loja', value: 35 },
			            { name: 'Los Ríos', value: 65 },
			            { name: 'Manabí', value: 55 },
			            { name: 'Morona Santiago', value: 10 },
			            { name: 'Napo', value: 15 },
			            { name: 'Orellana', value: 30 },
			            { name: 'Pastaza', value: 12 },
			            { name: 'Pichincha', value: 120 },
			            { name: 'Santa Elena', value: 50 },
			            { name: 'Santo Domingo', value: 25 },
			            { name: 'Sucumbíos', value: 20 },
			            { name: 'Tungurahua', value: 45 },
			            { name: 'Zamora Chinchipe', value: 18 }
			        ];


            data.sort(function (a, b) {
                return a.value - b.value;
            });

            // Opciones del mapa de ECharts
            const mapOption = {
                visualMap: {
                    left: 'right',
                    min: 50000,
                    max: 5000000,
                    inRange: {
                        color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
                    },
                    text: ['High', 'Low'],
                    calculable: true
                },
                series: [
                    {
                        id: 'population',
                        type: 'map',
                        roam: true,
                        map: 'Ecuador',
                        animationDurationUpdate: 1000,
                        universalTransition: true,
                        data: data
                    }
                ]
            };

            // Opciones del gráfico de barras
            const barOption = {
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    axisLabel: {
                        rotate: 30
                    },
                    data: data.map(function (item) {
                        return item.name;
                    })
                },
                animationDurationUpdate: 1000,
                series: {
                    type: 'bar',
                    id: 'population',
                    data: data.map(function (item) {
                        return item.value;
                    }),
                    universalTransition: true
                }
            };

            // Inicialmente establecer el mapa
            let currentOption = mapOption;
            myChart.setOption(mapOption);

            // Cambiar entre el mapa y el gráfico de barras cada 5 segundos
            setInterval(function () {
                currentOption = currentOption === mapOption ? barOption : mapOption;
                myChart.setOption(currentOption, true);
            }, 5000);  <!-- Cambié el intervalo a 5000 ms (5 segundos) -->

        }).fail(function () {
            myChart.hideLoading();
            console.log('Error al cargar el GeoJSON');
            alert("Error al cargar el mapa de Ecuador.");
        });
    </script>
</body>
</html>
