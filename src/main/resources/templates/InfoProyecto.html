<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	
	<meta charset="UTF-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

	<style>
		@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

		.main-content {
			margin-top: 50px;
		}

		.form-container {
			background: rgba(255, 255, 255, 0.9);
			padding: 40px;
			border-radius: 15px;
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
			max-width: 600px;
			margin: auto;
			transition: transform 0.3s ease-in-out;
		}

		.form-container:hover {
			transform: translateY(-5px);
		}

		.form-container h1 {
			text-align: center;
			color: #444;
			font-weight: 700;
			font-size: 24px;
		}

		.form-control {
			border-radius: 8px;
			border: 1px solid #ccc;
			padding: 10px;
			font-size: 16px;
			transition: all 0.3s ease-in-out;
		}

		.form-control:focus {
			border-color: #d32f2f;
			box-shadow: 0 0 12px rgba(211, 47, 47, 0.5);
		}

		.btn {
			background: linear-gradient(to right, #d32f2f, #b71c1c);
			color: white;
			border-radius: 8px;
			width: 100%;
			padding: 12px;
			font-size: 18px;
			font-weight: bold;
			transition: all 0.3s ease-in-out;
		}

		.btn:hover {
			background: #b71c1c;
			transform: scale(1.07);
			box-shadow: 0 6px 15px rgba(183, 28, 28, 0.3);
		}

		.btn:active {
			background: #d32f2f;
			transform: scale(0.98);
		}

		.footer {
			background-color: #222;
			color: white;
			text-align: center;
			padding: 10px;
			font-size: 14px;
			position: fixed;
			bottom: 0;
			width: 100%;
		}

		.footer p {
			margin: 0;
		}

		#map {
			height: 400px;
			width: 100%;
			margin-bottom: 20px;
		}
	</style>
</head>

<body>

	<div th:replace="layout/layoutVoluntario :: menuVoluntario"></div>

	<div class="container mt-5">
	    <h2 class="text-center mb-4" th:text="${proyecto.nombre}">Formulario Parcela</h2>
	    
	    <div class="card bg-light shadow">
	        <div class="card-body">
	            <div class="row g-4">
	                
	                <!-- Información del Proyecto (lado izquierdo) -->
	                <div class="col-md-6">
	                  
	                    <form th:action="@{/parcelas}" th:object="${parcela}">
	                        
	                        <input type="hidden" class="proyecto-id" th:value="${id_proyecto}">
	                        
	                        <div class="mb-3">
	                            <label class="form-label fw-bold">Fecha inicio del proyecto:</label>
	                            <p class="form-control-plaintext" th:text="${proyecto.fecha_inicio}"></p>
	                        </div>

	                        <div class="mb-3">
	                            <label class="form-label fw-bold">Número de integrantes máx.:</label>
	                            <p class="form-control-plaintext" th:text="${proyecto.voluntariosmax}"></p>
	                        </div>

	                        <div class="mb-3">
	                            <label class="form-label fw-bold">Patrocinador:</label>
	                            <p class="form-control-plaintext" th:text="${patrocinador.nombreEmpresa}"></p>
	                        </div>

	                        <div class="mb-3">
	                            <label class="form-label fw-bold">Representante:</label>
	                            <p class="form-control-plaintext">
	                                <span th:text="${usuario.nombre}"></span> <span th:text="${usuario.apellido}"></span>
	                            </p>
	                        </div>

	                        <div class="mb-3">
	                            <label class="form-label fw-bold">Donación:</label>
	                            <p class="form-control-plaintext" th:text="${patrocinio.cantiad_estimada}"></p>
	                        </div>

	                        <div class="mb-3">
	                            <label class="form-label fw-bold">Detalles de Donación:</label>
	                            <p class="form-control-plaintext" th:text="${patrocinio.detalledpnado}"></p>
	                        </div>

	                    </form>
	                </div>

	                <!-- Formulario y Mapa (lado derecho) -->
	                <div class="col-md-6">
	                    <h4 class="mb-3">Formulario Parcela Proyecto</h4>
	                    <div id="map" class="border rounded bg-light" style="height: 300px;"></div>
	                    <br>
	                    <button type="button" class="btn btn-outline-success w-100 inscribirme-btn">
	                        Inscribirme
	                    </button>
	                </div>

	            </div>
	        </div>
	    </div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", function () {

			// ✅ Captura todos los botones "Inscribirme"
			document.querySelectorAll(".inscribirme-btn").forEach(button => {
			    button.addEventListener("click", function () {
			        let proyectoId = this.closest(".card").querySelector(".proyecto-id").value;

			        if (proyectoId) {
			            // Redirige al controlador Spring Boot con el ID
			            window.location.href = "/inscribir?id=" + proyectoId;
			        } else {
			            // Si el ID es nulo, muestra un mensaje de error
			            mostrarToast("Error: No se recibió un ID válido.", "bg-danger");
			        }
			    });
			});
			
			
			
			

			
			var mapElement = document.getElementById('map');

			if (!mapElement) {
				console.error("No se encontró el elemento #map en el DOM.");
				return;
			}

			console.log("Inicializando Leaflet...");

			var map = L.map('map').setView([-2.838080, -79.224942], 12);

			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);

			map.on('click', function (e) {
				console.log("Coordenadas seleccionadas:", e.latlng);
				var xField = document.getElementById('x');
				var yField = document.getElementById('y');

				if (xField && yField) {
					xField.value = e.latlng.lng;
					yField.value = e.latlng.lat;
				} else {
					console.warn("No se encontraron los campos de coordenadas en el formulario.");
				}
			});
		});
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>